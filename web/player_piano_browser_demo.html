<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html>
<head>
	<title>Player Piano - Browser Edition</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<!-- Date: 2009-03-29 -->
	<!-- Author: Ivan Krozic -->
    <script type="text/javascript" src="jquery-1.2.6.min.js"></script>

	<!-- this is for jQuery / prototype namespace collision avoidance -->
	<script type="text/javascript">
	    jQuery = $;  //rename $ function
	 </script>

	<!-- left trim -->
	<script type="text/javascript" charset="utf-8">
		function ltrim(stringToTrim) {
			return stringToTrim.replace(/^\s+/,"");
		}
	</script>
	
    <script type="text/javascript" src="prototype-1.6.0.3.js"></script>


	<style type="text/css" media="screen">
		pre { background-color: #C4C4C4; min-height: 200px; }
		.red { color: #F00;}
	</style>
	
	<script type="text/javascript" charset="utf-8">
	
		// enter jQuery no conflict mode in order to 
		jQuery.noConflict();
 
		jQuery(document).ready(function() {	
			
			// time to refactor

			// SETUP
			var valid_line_starts = [ ">>>", "..."];
			
			var codeblock = jQuery("#example1").text();
			var lines = codeblock.split("\n");
			
			var check_valid_line = function(str) {
				var valid = false;
				for (var i=0; i < valid_line_starts.length; i++) {
					if ( str.startsWith(valid_line_starts[i]) ) {
						valid = true;
					}
				}
				return valid;
			}
			
			var index = 0;
			var handle_valid_line = function(str) {
				
				
				
			}
			// END SETUP
			
			
			
			//actual parser..
			
			// clean lines... 
			for (var i=0; i < lines.length; i++) {
				lines[i] = ltrim(lines[i]);
			};
			
			
			// step through the lines 
			for (var i=0; i < lines.length; i++) {

				if ( check_valid_line( lines[i] )) {
					// we need to step through the typer...
					handle_valid_line(lines[i]);
				} else {
					 // simply output the result
					jQuery("#output").append(lines[i] + "<br />");
				}
			
			};
			
			
			

			var which = 0;
			//do we currently need to look for output?
			var look_for_result_line = false;
			var exampleKeys = jQuery("#example1").text();
			
			var current_line = 0;
			var index = 0;


		    jQuery(document.body).bind('keypress', function(e) {

				var line = lines[current_line];


				
				var c = line[index];
				
				if ( !(index <= line.length) ) {
					//require an "Enter" press
					if (event.keyCode == 13) {
						current_line++;
						index = 0;
						jQuery("#output").append(c);
					}
				} else { 
					jQuery("#output").append(c);
					index++;
				}

				line = lines[current_line];

				// shortcut for lines that we know are not valid python lines...
				if ( !check_valid_line(line) ) {
					jQuery("#output").append(line);
					current_line++;
					index = 0;
					return;
				}
					
			});
			


		});

	</script>


</head>

<body>

	<pre id="example1">
	>>> print "hello world"
	hello world
	>>> def adder(x, y):
	...     return x + y
	>>> add_lambda = lambda y: adder(1, y)
	11
	</pre>
	
	<div id="hello">hello world</div>
	</div>

	<div id="output" style="border: 2px #CDCDCD solid; min-height: 300px;">	
	</div>

	



	</body>
</html>
