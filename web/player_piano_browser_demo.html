<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html>
<head>
	<title>Player Piano - Browser Edition</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<!-- Date: 2009-03-29 -->
	<!-- Author: Ivan Krozic -->
    <script type="text/javascript" src="jquery-1.2.6.min.js"></script>

	<!-- this is for jQuery / prototype namespace collision avoidance -->
	<script type="text/javascript">
	    jQuery = $;  //rename $ function
	 </script>

	<!-- left trim -->
	<script type="text/javascript" charset="utf-8">
		function ltrim(stringToTrim) {
			return stringToTrim.replace(/^\s+/,"");
		}
	</script>
	
    <script type="text/javascript" src="prototype-1.6.0.3.js"></script>


	<style type="text/css" media="screen">
		pre { background-color: #C4C4C4; min-height: 200px; }
		.red { color: #F00;}
	</style>
	
	<script type="text/javascript" charset="utf-8">
	
		//alert( "hello?: " + ltrim("          lakjsdfkjasdfljasdf"));


		jQuery.noConflict();
 
		jQuery(document).ready(function() {	
			
			// time to refactor

			var valid_line_starts = [ ">>>", "..."];
			
			var codeblock = jQuery("#example1").text();
			var lines = codeblock.split("\n");
			
			
			var check_valid_line = function(str) {
				var valid = false;
				for (var i=0; i < valid_line_starts.length; i++) {
					if ( str.startsWith(valid_line_starts[i]) ) {
						valid = true;
					}
				}
				return valid;
			}
			
			
			// clean lines... 
			for (var i=0; i < lines.length; i++) {
				lines[i] = ltrim(lines[i]);
			};
			
			//step through lines...
			for (var i=0; i < lines.length; i++) {

				jQuery("#output").append("|" + lines[i] + "|" + "<br />");
				
				//inspect if it has a valid line start 
				if ( check_valid_line(lines[i]) ) {
					alert("valid: " + lines[i]);					
				} else {
					alert("invalid: " + lines[i]);
				}
		
			
			};
			

			// step through the lines 
			for (var i=0; i < lines.length; i++) {
				
				// we need to step through the typer...
				if ( check_valid_line( lines[i] )) {
					
					
					
				} else {
					
					jQuery("#output2").append(lines[i] + "<br />");
					
				}
				
			};
			
			
			
			
			
			

			var which = 0;
			//do we currently need to look for output?
			var look_for_result_line = false;
			var exampleKeys = jQuery("#example1").text();
			
			
			jQuery("#example1").text("");

		    jQuery(document.body).bind('keypress', function(e) { 

				var next_source_char = exampleKeys.substr(which, 1);
				
				if (look_for_result_line == false) {
				
					if (next_source_char == '\n') { 
						
						look_for_result_line = true;
						
						if (event.keyCode == 13) {
							alert(' you hit enter at the end of a line!');
						} else {
							alert(' you hit a key when you should have hit enter! ')
							jQuery("#example1").append('\n');				
						}
					} else { 
						jQuery("#example1").append(exampleKeys.substr(which, 1));				
						//jQuery("#example1").append('key pressed: ' + event.keyCode + '<br />');
					}
				} else { 
					
					// we are looking for a result line, so next time, we don't want to look for a result line
					look_for_result_line = false;
					
					// inspect on line and see if it a result line...
					var possible_prompt = exampleKeys.substr(which, 4);
					
					if ( !(possible_prompt.match(">>>")) && !(possible_prompt.match("..."))) {
						alert('we found a non prompt line');
					}
					
					// need to grab the "result" line, and print out the line...
					var result_line = "";
					while( which < exampleKeys.length) {
						var c = exampleKeys.substr(which, 1);
						result_line += c;
						if ( c == "\n" ) {
							break;
						}
						which += 1;
					}
					
					jQuery("#example1").append(result_line);
				}
				
				//if we just pressed enter, then we need to determine if the next line needs to be a 'result' line...
				if (event.keyCode == 13) {
					look_for_output = true;
				}
			
				which += 1;
			});

		});

	</script>


</head>

<body>

	<pre id="example1">
	>>> print "hello world"
	hello world
	>>> def adder(x, y):
	...     return x + y
	>>> add_lambda = lambda y: adder(1, y)
	11
	</pre>
	
	<div id="hello">hello world</div>

	<div id="output" style="border: 2px #CDCDCD solid; min-height: 300px;">
	
	</div>
	<br><br>
	<div id="output2" style="border: 2px #CDCDCD solid; min-height: 300px;">
	
	</div>
	


	</body>
</html>
